---
title: 'Model call record'
output: pdf_document
classoption: landscape
author: Sasha D. Hafner
date: "`r format(Sys.time(), '%d %B, %Y %h:%m')`"
---

Check package version.

```{r}
packageVersion('ALFAM2')
```

Parameter values.

```{r}
ALFAM2pars02
```

Run model 

With sets 1 and 2 excluding pH.

```{r}
pars01 <- ALFAM2pars01[!grepl('man.ph', names(ALFAM2pars01))]
pars02 <- ALFAM2pars02[!grepl('man.ph', names(ALFAM2pars02))]
```

```{r}
d.pred.ps1 <- as.data.table(alfam2(as.data.frame(idat1), pars = pars01, app.name = 'tan.app', time.name = 'cta', group = 'pmid'))
d.pred.ps2 <- as.data.table(alfam2(as.data.frame(idat1), pars = pars02, app.name = 'tan.app', time.name = 'cta', group = 'pmid'))
```

```{r}
names(d.pred.ps1)[-1:-3] <- paste0(names(d.pred.ps1)[-1:-3], '.pred')
names(d.pred.ps2)[-1:-3] <- paste0(names(d.pred.ps2)[-1:-3], '.pred')

d.pred.ps1$pars <- 'ps1'
d.pred.ps2$pars <- 'ps2'

d1 <- cbind(idat1, d.pred.ps1[, -1:-3])
d2 <- cbind(idat1, d.pred.ps2[, -1:-3])
dpreds <- rbind(d1, d2)
```


Plot

```{r}
ggplot(dpreds, aes(cta, er, group = pmid)) +
  geom_line() +
  facet_wrap(~ app.mthd)
```

```{r}
x <- dpreds[institute == 'AU' & meas.tech == 'bLS', ]
ggplot(x, aes(cta, er, colour = app.mthd)) +
  geom_line() +
  geom_line(aes(cta, er.pred), lty = '11') +
  facet_grid(pmid ~ pars)
```

